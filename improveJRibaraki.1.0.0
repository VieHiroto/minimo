(function() {
    'use strict';

    // 指定されたスタッフのリスト
    var targetStaff = [
        "藤井 菜緒",
        "三原 夢菜",
        "シールエクステ/ ハイトーンカラー",
        "百合野 利啓",
        "桑田 新菜",
    ];

    // スタッフの公開/非公開を切り替える関数
    function toggleStaffVisibility() {
        // 全ての選択要素を取得
        var selectElements = document.querySelectorAll('.m_staff_card_action .a_select');

        if (selectElements.length > 0) {
            let index = 0;

            function processNext() {
                if (index < selectElements.length) {
                    var selectElement = selectElements[index];
                    var cardTitle = selectElement.closest('.m_staff_card_action').previousElementSibling.querySelector('.m_staff_card_title');
                    if (cardTitle && targetStaff.includes(cardTitle.textContent.trim())) {
                        // 公開状態を非公開に変更
                        selectElement.value = '1'; // 1は「非公開」
                        var event = new Event('change', { bubbles: true });
                        selectElement.dispatchEvent(event);
                    }
                    index++;
                    setTimeout(processNext, 1000); // 1秒待機
                } else {
                    setTimeout(() => {
                        index = 0;
                        processNextToggle();
                    }, 5000); // 全ての非公開処理後に5秒待機
                }
            }

            function processNextToggle() {
                if (index < selectElements.length) {
                    var selectElement = selectElements[index];
                    var cardTitle = selectElement.closest('.m_staff_card_action').previousElementSibling.querySelector('.m_staff_card_title');
                    if (cardTitle && targetStaff.includes(cardTitle.textContent.trim())) {
                        selectElement.value = '0'; // 0は「公開」
                        var event = new Event('change', { bubbles: true });
                        selectElement.dispatchEvent(event);
                    }
                    index++;
                    setTimeout(processNextToggle, 1000); // 1秒待機
                }
            }



            processNext();

                // 60秒後にページをリロード
                setTimeout(function() {
                    location.reload();
                }, 60000);

        }

        // 次の実行時間を設定 (ランダムな30〜75分の間隔)
        nextExecution = new Date().getTime() + (30 + Math.random() * 45) * 60 * 1000;
    }

    // カウントダウンタイマーの更新
    function updateCountdown() {
        var now = new Date().getTime();
        var timeLeft = nextExecution - now;

        if (timeLeft <= 0) {
            toggleStaffVisibility();
        }

        var minutes = Math.floor((timeLeft % (1000 * 90 * 60)) / (1000 * 60));
        var seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

        countdownElement.textContent = `次の実行まで: ${minutes}分 ${seconds}秒`;
    }

    // 初回実行
    var nextExecution = new Date().getTime();
    toggleStaffVisibility();

    // カウントダウンタイマーの更新を毎秒行う
    setInterval(updateCountdown, 1000);

    // カウントダウン表示の作成
    var countdownElement = document.createElement('div');
    countdownElement.style.position = 'fixed';
    countdownElement.style.bottom = '10px';
    countdownElement.style.right = '10px';
    countdownElement.style.zIndex = 1000;
    countdownElement.style.padding = '10px';
    countdownElement.style.backgroundColor = '#333';
    countdownElement.style.color = 'white';
    countdownElement.style.border = 'none';
    countdownElement.style.borderRadius = '5px';

    document.body.appendChild(countdownElement);

    // 初回カウントダウンの表示
    updateCountdown();
})();
