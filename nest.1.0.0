(function() {
    'use strict';

    // åå‰ã‚’å¤‰æ•°ã¨ã—ã¦å®šç¾©
    var excludedStaffNames = ["çŸ³å· æ­¦äºº","ãƒœãƒ–/ç¾é«ªã‚«ãƒ©ãƒ¼/ ã¾ã¤ã’ãƒ‘ãƒ¼ãƒ/ã¯ã‚‹ã‹","MIO å¤§é˜ª ãƒã‚¤ãƒˆãƒ¼ãƒ³ğŸŒŸ"];

    // ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒ1åº¦ã ã‘å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
    var hasRun = false;

    // ã‚¹ã‚¿ãƒƒãƒ•ã®éå…¬é–‹ã«å¤‰æ›´ã™ã‚‹é–¢æ•°
    function toggleStaffVisibility() {
        if (hasRun) return; // æ—¢ã«å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ä½•ã‚‚ã—ãªã„
        hasRun = true; // å®Ÿè¡Œãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹

        // å…¨ã¦ã®é¸æŠè¦ç´ ã‚’å–å¾—
        var selectElements = document.querySelectorAll('.m_staff_card_action .a_select');

        // éå…¬é–‹ã«å¤‰æ›´
        selectElements.forEach(function(selectElement) {
            var cardTitle = selectElement.closest('.m_staff_card_action').previousElementSibling.querySelector('.m_staff_card_title');
            var staffName = cardTitle ? cardTitle.textContent.trim() : '';
            if (staffName && !excludedStaffNames.includes(staffName)) { // é…åˆ—ã«å«ã¾ã‚Œã¦ã„ãªã„å ´åˆ
                selectElement.value = '1'; // 1ã¯ã€Œéå…¬é–‹ã€
                var event = new Event('change', { bubbles: true });
                selectElement.dispatchEvent(event);
            }
        });

        // 7ç§’å¾…æ©Ÿã—ã¦ã‹ã‚‰å…¬é–‹ã«å¤‰æ›´ï¼ˆéå…¬é–‹å¾Œã«è¡Œã‚ã‚Œã‚‹å°‚ç”¨ã®å‡¦ç†ï¼‰
        setTimeout(changeToPublicFromPrivate, 7000);
    }

    // éå…¬é–‹ã‹ã‚‰å…¬é–‹ã«å¤‰æ›´ã™ã‚‹é–¢æ•°ï¼ˆéå…¬é–‹å‡¦ç†å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ï¼‰
    function changeToPublicFromPrivate() {
        var selectElements = document.querySelectorAll('.m_staff_card_action .a_select');

        selectElements.forEach(function(selectElement, index) {
            var cardTitle = selectElement.closest('.m_staff_card_action').previousElementSibling.querySelector('.m_staff_card_title');
            var staffName = cardTitle ? cardTitle.textContent.trim() : '';
            if (staffName && !excludedStaffNames.includes(staffName)) { // é…åˆ—ã«å«ã¾ã‚Œã¦ã„ãªã„å ´åˆ
                selectElement.value = '0'; // 0ã¯ã€Œå…¬é–‹ã€
                var event = new Event('change', { bubbles: true });
                selectElement.dispatchEvent(event);
            }

            // å…¨ã¦ã®è¦ç´ ãŒå…¬é–‹ã«å¤‰æ›´ã•ã‚ŒãŸå¾Œã«ãƒªãƒ­ãƒ¼ãƒ‰ã‚’è¡Œã†
            if (index === selectElements.length - 1) { // æœ€å¾Œã®è¦ç´ ã«åˆ°é”ã—ãŸã¨ã
                setTimeout(function() {
                    location.reload();
                }, 3000); // å…¬é–‹å‡¦ç†ãŒå®Œäº†ã—ã¦3ç§’å¾Œã«ãƒªãƒ­ãƒ¼ãƒ‰
            }
        });
    }

    // æ‰‹å‹•ã¾ãŸã¯ã‚¿ã‚¤ãƒãƒ¼ã§å…¬é–‹ã«å¤‰æ›´ã™ã‚‹é–¢æ•°
    function changeToPublicManual() {
        var selectElements = document.querySelectorAll('.m_staff_card_action .a_select');

        selectElements.forEach(function(selectElement) {
            var cardTitle = selectElement.closest('.m_staff_card_action').previousElementSibling.querySelector('.m_staff_card_title');
            var staffName = cardTitle ? cardTitle.textContent.trim() : '';
            if (staffName && !excludedStaffNames.includes(staffName)) { // é…åˆ—ã«å«ã¾ã‚Œã¦ã„ãªã„å ´åˆ
                selectElement.value = '0'; // 0ã¯ã€Œå…¬é–‹ã€
                var event = new Event('change', { bubbles: true });
                selectElement.dispatchEvent(event);
            }
        });
    }

    // æ¬¡ã®å®Ÿè¡Œæ™‚é–“ã‚’è¨­å®š (ãƒ©ãƒ³ãƒ€ãƒ ãª30ã€œ50åˆ†ã®é–“éš”)
    var nextExecution = new Date().getTime() + (30 + Math.random() * 20) * 60 * 1000;

    // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒãƒ¼ã®æ›´æ–°
    function updateCountdown() {
        var now = new Date().getTime();
        var timeLeft = nextExecution - now;

        if (timeLeft <= 0) {
            toggleStaffVisibility();
            return; // å®Ÿè¡Œå¾Œã«å³åº§ã«ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³æ›´æ–°ã‚’çµ‚äº†ã™ã‚‹
        }

        var minutes = Math.floor((timeLeft % (1000 * 90 * 60)) / (1000 * 60));
        var seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

        countdownElement.textContent = `æ¬¡ã®å®Ÿè¡Œã¾ã§: ${minutes}åˆ† ${seconds}ç§’`;
    }

    // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤ºã®ä½œæˆ
    var countdownElement = document.createElement('div');
    countdownElement.style.position = 'fixed';
    countdownElement.style.bottom = '10px';
    countdownElement.style.right = '10px';
    countdownElement.style.zIndex = 1000;
    countdownElement.style.padding = '10px';
    countdownElement.style.backgroundColor = '#333';
    countdownElement.style.color = 'white';
    countdownElement.style.border = 'none';
    countdownElement.style.borderRadius = '5px';

    document.body.appendChild(countdownElement);

    // åˆå›ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã®è¡¨ç¤º
    updateCountdown();

    // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒãƒ¼ã®æ›´æ–°ã‚’æ¯ç§’è¡Œã†
    setInterval(updateCountdown, 1000);

    // ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‹ã‚‰1åˆ†å¾Œã«æ‰‹å‹•ã§å…¬é–‹ã«å¤‰æ›´
    setTimeout(changeToPublicManual, 60000); // ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‹ã‚‰1åˆ†å¾Œ

    // ãƒœã‚¿ãƒ³ã‚’ä½œæˆã—ã¦ãƒšãƒ¼ã‚¸ã«è¿½åŠ 
    var button = document.createElement('button');
    button.innerText = 'éå…¬é–‹ã«ãªã‚‹å ´åˆã“ã¡ã‚‰ã‚’ã‚¯ãƒªãƒƒã‚¯'; // ãƒœã‚¿ãƒ³ã«è¡¨ç¤ºã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆ
    button.style.position = 'fixed';
    button.style.bottom = '60px';
    button.style.right = '20px';
    button.style.padding = '10px 20px';
    button.style.backgroundColor = '#4CAF50'; // èƒŒæ™¯è‰²
    button.style.color = 'white'; // æ–‡å­—è‰²
    button.style.border = 'none'; // ãƒœãƒ¼ãƒ€ãƒ¼ã‚’æ¶ˆã™
    button.style.borderRadius = '5px'; // ãƒœã‚¿ãƒ³ã®è§’ã‚’ä¸¸ãã™ã‚‹
    button.style.cursor = 'pointer'; // ã‚«ãƒ¼ã‚½ãƒ«ã‚’ãƒã‚¤ãƒ³ã‚¿ã«ã™ã‚‹

    // ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã«æ‰‹å‹•ã§å…¬é–‹ã«å¤‰æ›´
    button.addEventListener('click', changeToPublicManual);

    // ãƒšãƒ¼ã‚¸ã®bodyã«ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
    document.body.appendChild(button);
})();
